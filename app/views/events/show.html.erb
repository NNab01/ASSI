
<h1>Events#show</h1>
<% if flash[:success] %>
  <div class="success-message">
    <%= flash[:success] %>
  </div>
<% end %>
<div class="events-show" >
<div class="myCard">
        <div class="innerCard">
            <div class="frontSide">
               <p class="title"><%= @event.title %></p>
                <p>Location: <%= @event.location %></p>
                <p>Price: <%= @event.price %></p>
                <p>Date: <%= @event.date %></p>
                <div class="card-footer text-right " style="border-top: 1px solid rgba(0,0,0,0);">
          Average Value: <%= @event.evaluations.average(:value) %> / 10
        </div>
            </div>
            <div class="backSide">
                <%= link_to "",:back ,class:"btn-close", style:"position:absolute; top:5%;right:5%;"%>

                <p class="title">DESCRIZIONE</p>
                <p>Presales left: <%= @event.presales_left %></p>
                <p>Organizer: <%if User.find(@event.organizer_id).username!=nil %>
                <%= link_to User.find(@event.organizer_id).username, user_path(User.find(@event.organizer_id)) %>
                 <%end%></p>
                 <% if can?(:manage,:all)%>
    <p>Lista Acquirenti<% presales=Presale.where(event_id: params[:id])%>
    <% usernames = presales.map { |presale| presale.user.username }.uniq%>
    <% usernames.each do |key, value|%>
    <%= value %>
    <%end%>
<%end%>
   
      </div>
     </div>
    </div>


</div>
<div class="buttons-group mt-3" style="width:100%">
  <%= link_to events_path  do%>
<button class="back">

  <svg height="16" width="16" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1024 1024">
  <path d="M874.690416 495.52477c0 11.2973-9.168824 20.466124-20.466124 20.466124l-604.773963 0
   188.083679 188.083679c7.992021 7.992021 7.992021 20.947078 0 28.939099-4.001127 3.990894-9.240455 
   5.996574-14.46955 5.996574-5.239328 0-10.478655-1.995447-14.479783-5.996574l-223.00912-223.00912c-3.837398-3.837398-5.996574-9.046027-5.996574-14.46955 0-5.433756 2.159176-10.632151 5.996574-14.46955l223.019353-223.029586c7.992021-7.992021 20.957311-7.992021
    28.949332 0 7.992021 8.002254 7.992021 20.957311 0 28.949332l-188.073446 188.073446 604.753497 0C865.521592 475.058646 
    874.690416 484.217237 874.690416 495.52477z"></path></svg>
  Back
</button>
<%end%>
<% if @event.organizer_id==current_user.id%>
<%= link_to "Elimina",event_path(id: @event.id),method: :delete, class: "btn btn-danger"%> <!-- metodo base per riferirsi alla destroy altrimenti si hanno problemi -->
<% if !Ban.where(user_id: current_user.id).exists?%>
<%= link_to "Modifica",edit_event_path, class: "btn btn-success" %>
<%end%>
<% end%>
<% if @event.status=="published"%>
<% if !Evaluation.exists?(event_id: @event.id, user_id: current_user.id)%>
<% if !Ban.where(user_id: current_user.id).exists?%>
<%= link_to "Valuta",new_event_evaluation_path(event_id: @event.id),class: "btn btn-warning"  %>
<% end%>
<%end%>

<%end%>

<button class="premium-button">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 24">
        <path d="m18 0 8 12 10-8-4 20H4L0 4l10 8 8-12z"></path>
    </svg>
<%= link_to "Acquista" ,all_presales_path(event_id: @event.id)%></button>
</div>
<nav class="navbar fixed-bottom navbar-light d-flex justify-content-center align-items-center" style="border-top:solid 1px grey">

  <!-- Icona "Home" -->
  <%= link_to events_path do %>
    <i class="fas fa-home fa-2x" ></i>
<% end %>

  <!-- Icona "Aggiungi" -->
  <% if can?(:create, Event)%>
  <% if !Ban.where(user_id: current_user.id).exists?%>
  <%= link_to new_event_path do %>
  <a href="<%= new_event_path %>">
    <i class="fas fa-plus fa-2x"></i>
  <% end %>
<% end %>
<%end%>
<!-- Icona "Salva" -->
<%= link_to user_saves_path(user_id: current_user.id) do %>
    <i class="fas fa-star fa-2x"></i>
  </a>
  <%end%>
 <!-- Icona "Utente" -->
<%= link_to user_path(current_user) do %>
    <i class="fas fa-user fa-2x" ></i>
<% end %> 

</nav>
